---
title: "Raport śledzi"
author: "Adam Chojan"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    css: custom.css
    keep_md: yes
    number_sections: yes
    toc: yes
---

```{r setup, include=FALSE,  echo=FALSE}
knitr::opts_chunk$set(echo = FALSE,message=FALSE)
```


#Wprowadzenie
Tu będzie krótki opis

#Biblioteki
```{r library, echo=TRUE,message=FALSE}
library(knitr)
library(dplyr)
library(ggplot2)
library(hexbin)
library(plotly)
library(reshape2)
library(mice)
library(tidyr)
```

##Wczytanie danych

```{r load_file, echo=TRUE,message=FALSE, cache = TRUE}
mydata = read.csv("sledzie.csv")
df <- data.frame(mydata)
df[df == '?'] <- NA
my_df <- tbl_df(df)
```

#Wstępne rozpoznanie
##Ogólne statystyki dla danych
```{r introduction}
kable(summary(my_df), caption = "Tabela podsumująca zbiór danych")

kable(head(my_df), caption = "Tabela zawierająca początkowe wiersze")

uniq <- my_df %>% summarise_each(funs(n_distinct(., na.rm = TRUE)))
kable(uniq, caption = "Tabela unikalnych wartości")
```

##Wartości brakujące
Z ogólnych statystyk dla danych dotyczących śledzi można odczytać 6 kolumn, które zawierają wartości brakujące. Ten rozdział raportu będzie poświęcony analizie tych wartości na podstawie, której zostanie podjęta decyzja w jaki sposób zostanie rozwiązany problem - zostawić brakujące wartości, usunąć wiersze z brakującymi wartościami lub wypełnić luki w danych.

###Analiza wartości brakujących
Pierwszym krokiem jest sprawdzenie jaka jest liczba unikalnych wartości


```{r missing_valeues_uniq, message=FALSE}
uniq_mv <- my_df %>% select(cfin1:lcop2,sst) %>% summarise_each(funs(n_distinct(., na.rm = TRUE)))
kable(uniq_mv, caption = "Tabela unikalnych wartości")
```

```{r missing_valeues_pattern, message=FALSE, cache=TRUE}

only_missing_col <- select(my_df,cfin1:lcop2,sst)
missing_pattern <- tbl_df(md.pattern(only_missing_col))
missing_pattern2 <- select(missing_pattern,cfin2:lcop1)
missing_pattern2[missing_pattern2==0]<-NA

#Wykres wzorcóW brakujących wartości
missing_pattern2[-nrow(missing_pattern2),] %>% is.na %>% melt %>% ggplot(data = .,aes(x = Var2,y = Var1)) +
    geom_raster(aes(fill = value)) + scale_fill_grey(name = "",labels = c("Obecne","Brakujące")) + 
    theme_minimal() + theme(axis.text.x  = element_text(angle=45, vjust=0.5)) + 
    labs(x = "Zmienne z brakującymi wartościami", y="Wzorce brakujących wartości") + 
    ggtitle("Wykres wzorców brakujących wartości")

mv_count <- melt(data= missing_pattern2[nrow(missing_pattern2),],)
plot_mv_count <- ggplot(mv_count,aes(x=variable,y=value, fill=variable))+geom_bar(stat="identity") + 
                    labs(x = "Zmienne z brakującymi wartościami", y="Liczba brakujących wartości") + 
                    ggtitle("Wykres wzorców brakujących wartości") + 
                    theme_minimal() + theme(legend.position="none")
plot_mv_count
```

###Wypełnienie brakujących wartości

```{r missing_fill,echo=TRUE}
new_my_df<-my_df %>% fill(cfin1:lcop2,sst,.direction = "up") %>% fill(cfin1:lcop2,sst,.direction = "down")

kable(summary(new_my_df))

```



#Zmiana długości śledzi w czasie

```{r plot_sledzie_time,  cache=TRUE}
plot_length <- ggplot(new_my_df,aes(X,length))  + geom_line(alpha=0.3) + stat_smooth(method="auto",size = 2)
plot_length <- plot_length + theme(axis.text.x=element_blank(),axis.ticks.x=element_blank()) + xlab("Czas") + ylab("Długość śledzia") + theme_minimal() 
plot_length

plot_length_hex <- ggplot(new_my_df,aes(X,length)) +geom_hex()
plot_length_hex <- plot_length_hex + theme(axis.text.x=element_blank(),axis.ticks.x=element_blank()) + xlab("Czas") + ylab("Długość śledzia") + theme_minimal() 
ggplotly(plot_length_hex)
```

#Analiza atrybutóW
wykresy z tekstem

#Korelacja między zmiennymi
obliczenie korelacji + wykresy

#Regresor przewidujący rozmiar śledzia
bedzie regresor

#Ważność atrybutów w opataciu o regresor


